[tool.ruff]
line-length = 100
target-version = "py311"
exclude = [
  # Phase 1 lint scope intentionally excludes legacy & migration code; will be reintroduced in later pockets.
  "migrations",
  "legacy",
  "core/static",
  "core/templates",
  "tests",
]
extend-exclude = ["**/*.md"]

# Compatibility for older Ruff versions (<0.4): duplicate lint keys at top-level
select = ["E","F","I","UP","SIM","B","Q"]
ignore = [
  "E501",
  "SIM105",
]

[tool.ruff.isort]
line-length = 120
select = ["E","F","I","UP","SIM","B","Q"]
ignore = [
  "E501",
  "SIM105",
  "F401",
  "F841",
  "F821",
  "F541",
  "E401",
  "E702",
  "B904",
  "B023",
]

known-first-party = ["core", "modules"]
combine-as-imports = true

[tool.ruff.per-file-ignores]
"__init__.py" = ["F401"]
"migrations/env.py" = ["E402", "F401", "F403"]
"migrations/versions/*.py" = ["E402", "F401", "F403"]
"legacy/**" = ["E701", "E702", "E402"]
"tests/**" = ["E701", "E702", "SIM105", "B011", "F401"]
"tests/test_openapi_validator.py" = ["B017"]
"scripts/*.py" = ["E402"]

[tool.ruff.lint]
# Baseline + expanded: bugbear (B), pyupgrade (UP), quotes (Q), plus pattern/simplification sets PIE & SIM.
select = ["E","F","I","UP","SIM","B","Q"]
ignore = [
  # Temporarily ignore line length (can be enabled later by removing E501 here & adding a formatting step)
  "E501",
  "SIM105",
  # CI hygiene: ignore noisy non-functional findings pending pocket cleanups
  "F401",  # unused imports in pockets
  "F841",  # assigned-but-unused locals
  "F821",  # undefined names in unreachable/demo code paths
  "F541",  # f-string without placeholders
  "E401",  # multiple imports per line (legacy pockets)
  "E702",  # multiple statements per line (legacy pockets)
  "B904",  # exception chaining strictness
  "B023",  # loop variable binding in nested defs
]

[tool.ruff.lint.isort]
known-first-party = ["core", "modules"]
combine-as-imports = true

[tool.ruff.lint.per-file-ignores]
# Allow __init__ files to re-export without usage
"__init__.py" = ["F401"]
# Alembic env and versions often have unused imports / naming differing from style
"migrations/env.py" = ["E402", "F401", "F403"]
"migrations/versions/*.py" = ["E402", "F401", "F403"]
# Legacy/offshore and legacy tooling scripts: tolerate style violations for now (batch cleanup later)
"legacy/**" = ["E701", "E702", "E402"]
# Tests: temporarily ignore mass semicolon/colon multi-statement style to focus on functional code improvements first
"tests/**" = ["E701", "E702", "SIM105", "B011"]
"tests/test_openapi_validator.py" = ["B017"]
"scripts/*.py" = ["E402"]

[tool.ruff.format]
quote-style = "preserve"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"

[tool.ruff.flake8-quotes]
# Compatibility for older Ruff versions (<0.4)
inline-quotes = "double"
multiline-quotes = "double"
docstring-quotes = "double"

[tool.ruff.lint.flake8-quotes]
# Enforce double quotes consistently to reduce noisy Q000 violations.
inline-quotes = "double"
multiline-quotes = "double"
docstring-quotes = "double"

[tool.mypy]
# Target runtime is Python 3.11, even if CI/dev may use newer interpreters.
python_version = "3.11"
# Allow third-party packages without type stubs to pass for RC.
ignore_missing_imports = true
# Keep config clean by warning on unused ignores added during triage.
warn_unused_ignores = true
# Enable strict Optional handling; other strict flags can come later post-RC.
strict_optional = true
