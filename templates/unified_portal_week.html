<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Avdelningsvy â€“ Vecka {{ vm.week }}, {{ vm.year }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='unified_ui.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='unified_portal.css') }}">
  <script src="{{ url_for('static', filename='unified_portal.js') }}" defer></script>
  <script src="{{ url_for('static', filename='unified_ui.js') }}" defer></script>
  {% include 'includes/yuplan_header.html' ignore missing %}
</head>
<body>
<header class="yp-header">
  <div class="yp-header__title">Avdelningsportalen</div>
  <div class="yp-header__meta">
    <span>Vecka {{ vm.week }}, {{ vm.year }}</span>
    <span>â€¢ {{ vm.department_name }}</span>
    <span>â€¢ {{ vm.site_name }}</span>
  </div>
</header>

<main class="portal-container">
<main class="portal-container"
  data-site-id="{{ vm.site_id }}"
  data-department-id="{{ vm.department_id }}"
  data-year="{{ vm.year }}"
  data-week="{{ vm.week }}">
  <section class="portal-summary">
    <h1 class="portal-summary__title">Vecka {{ vm.week }}, {{ vm.year }} â€“ {{ vm.department_name }}, {{ vm.site_name }}</h1>
  </section>

  <section class="portal-day-grid" aria-label="Veckans meny">
    {% for day in vm.days %}
    <article class="yp-card portal-day-card" data-is-today="{{ 'true' if day.is_today else 'false' }}">
      <div class="portal-day-card__header {{ 'is-today' if day.is_today }}">
        <div class="portal-day-card__title">
          {{ day.weekday_name }} {{ day.date | replace('-', '/') }}
        </div>
        {% if day.is_today %}
        <span class="yp-badge yp-badge-info">Idag</span>
        {% endif %}
      </div>

       {% if day.menu.lunch.alt1 or day.menu.lunch.alt2 or day.menu.lunch.dessert %}
       <div class="meal-block" role="button" tabindex="0"
        aria-label="Lunch {{ day.weekday_name }} {{ day.date }}{{ ', Registrerad' if day.registered.lunch else '' }}{{ ', Alt 2' if day.alt2_lunch else '' }}"
        data-day="{{ day.date }}" data-day-key="{{ day.date }}" data-meal="lunch">
        <div class="meal-block__header">
          <span class="meal-icon" aria-hidden="true">ğŸ½</span>
          <span class="meal-label">LUNCH</span>
          <span class="meal-badges">
            {% if day.registered.lunch %}
              <span class="yp-badge yp-badge-success">Registrerad</span>
            {% else %}
              <span class="yp-badge yp-badge-muted">Ej gjord</span>
            {% endif %}
            {% if day.alt2_lunch %}
              <span class="yp-badge yp-badge-warning">âš¡ Alt 2</span>
            {% endif %}
          </span>
        </div>
        <div class="meal-text meal-text--alt1">{{ day.menu.lunch.alt1 }}</div>
        {% if day.menu.lunch.alt2 %}
        <div class="meal-text meal-text--alt2">{{ day.menu.lunch.alt2 }}</div>
        {% endif %}
        {% if day.menu.lunch.dessert %}
        <div class="meal-text meal-text--dessert">{{ day.menu.lunch.dessert }}</div>
        {% endif %}
         {% if day.residents.lunch and day.residents.lunch > 0 %}
         <div class="residents-count">Boende: {{ day.residents.lunch }}</div>
         {% endif %}
        {% if day.default_diets and day.default_diets|length > 0 %}
        <div class="meal-diets" aria-hidden="true">
          {% for d in day.default_diets %}
          <span class="yp-badge yp-badge-secondary">{{ d.name }} [{{ d.count }}]</span>
          {% endfor %}
        </div>
        {% endif %}
      </div>
      {% endif %}

       {% if vm.has_dinner and (day.menu.dinner.alt1 or day.menu.dinner.alt2) %}
       <div class="meal-block" role="button" tabindex="0"
        aria-label="KvÃ¤llsmat {{ day.weekday_name }} {{ day.date }}{{ ', Registrerad' if day.registered.dinner else '' }}"
        data-day="{{ day.date }}" data-day-key="{{ day.date }}" data-meal="dinner">
        <div class="meal-block__header">
          <span class="meal-icon" aria-hidden="true">ğŸŒ™</span>
          <span class="meal-label">KVÃ„LLSMAT</span>
          <span class="meal-badges">
            {% if day.registered.dinner %}
              <span class="yp-badge yp-badge-success">Registrerad</span>
            {% else %}
              <span class="yp-badge yp-badge-muted">Ej gjord</span>
            {% endif %}
          </span>
        </div>
        <div class="meal-text meal-text--alt1">{{ day.menu.dinner.alt1 }}</div>
        {% if day.menu.dinner.alt2 %}
        <div class="meal-text meal-text--alt2">{{ day.menu.dinner.alt2 }}</div>
        {% endif %}
      </div>
      {% endif %}
    </article>
    {% endfor %}
  </section>
</main>

{% include 'includes/yuplan_footer.html' ignore missing %}
</body>
</html>
