<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8">
  <title>K√∂k ‚Äì Planering</title>
  <link rel="stylesheet" href="/static/css/unified_cook.css">
  <link rel="stylesheet" href="/static/unified_ui.css">
  <link rel="stylesheet" href="/static/css/kitchen_planering_print.css">
</head>
<body class="cook-dashboard">
  <div class="cook-content">
    <h1 class="section-title">K√∂k ‚Äì Planering</h1>
    <p class="empty-text">V√§lj vecka, dag och m√•ltid f√∂r att se sammanst√§llning.</p>

    <div class="kp-controls">
      <div class="kp-card">
        <div class="kp-toolbar">
          <div class="kp-week-picker" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            <a class="kp-button" aria-label="F√∂reg√•ende vecka"
               href="?site_id={{ vm.site_id }}&year={{ vm.prev_year }}&week={{ vm.prev_week }}&day={{ vm.selected_day if vm.selected_day is not none else '' }}&meal={{ vm.selected_meal or '' }}">‚üµ F√∂reg√•ende</a>
            <form method="get" action="" style="display:flex;gap:6px;align-items:center;">
              <input type="hidden" name="site_id" value="{{ vm.site_id }}">
              <input type="hidden" name="day" value="{{ vm.selected_day if vm.selected_day is not none else '' }}">
              <input type="hidden" name="meal" value="{{ vm.selected_meal or '' }}">
              <label for="week-select">Vecka</label>
              <select id="week-select" name="week">
                {% for w in vm.week_options %}
                  <option value="{{ w }}" {% if vm.week == w %}selected{% endif %}>{{ w }}</option>
                {% endfor %}
              </select>
              <label for="year-select">√Ör</label>
              <select id="year-select" name="year">
                {% for y in vm.year_options %}
                  <option value="{{ y }}" {% if vm.year == y %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
              </select>
              <button type="submit" class="kp-button">V√§lj</button>
            </form>
            <a class="kp-button" aria-label="N√§sta vecka"
               href="?site_id={{ vm.site_id }}&year={{ vm.next_year }}&week={{ vm.next_week }}&day={{ vm.selected_day if vm.selected_day is not none else '' }}&meal={{ vm.selected_meal or '' }}">N√§sta ‚ü∂</a>
          </div>
          <div class="kp-day-buttons">
            {% for label in vm.day_labels %}
              {% set idx = loop.index0 %}
              <a href="?site_id={{ vm.site_id }}&year={{ vm.year }}&week={{ vm.week }}&day={{ idx }}&meal={{ vm.selected_meal or '' }}"
                 class="kp-button {% if vm.selected_day is not none and vm.selected_day == idx %}is-active{% endif %}">{{ label }}</a>
            {% endfor %}
          </div>
          <div class="kp-meal-buttons">
            <a href="?site_id={{ vm.site_id }}&year={{ vm.year }}&week={{ vm.week }}&day={{ vm.selected_day if vm.selected_day is not none else '' }}&meal=lunch"
               class="kp-button {% if vm.selected_meal == 'lunch' %}is-active{% endif %}">üçΩÔ∏è Lunch</a>
            <a href="?site_id={{ vm.site_id }}&year={{ vm.year }}&week={{ vm.week }}&day={{ vm.selected_day if vm.selected_day is not none else '' }}&meal=dinner"
               class="kp-button {% if vm.selected_meal == 'dinner' %}is-active{% endif %}">üåô Middag</a>
            <button class="kp-button" onclick="window.print()">Skriv ut</button>
            {% if vm.selected_day is not none %}
              <button type="button"
                      class="kp-button js-open-menu-modal"
                      data-site-id="{{ vm.site_id }}"
                      data-year="{{ vm.year }}"
                      data-week="{{ vm.week }}"
                      data-day-index="{{ vm.selected_day }}"
                      {% if vm.selected_meal %}data-focus-meal="{{ vm.selected_meal }}"{% endif %}
              >Visa meny</button>
            {% else %}
              <button type="button" class="kp-button js-open-menu-modal" disabled>Visa meny</button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="kp-card">
      {% if vm.selected_day is none or vm.selected_meal is none or not vm.summary %}
        <div class="empty-state">
          <div class="empty-icon">üìù</div>
          <h2 class="empty-text">V√§lj dag och m√•ltid</h2>
          <p class="empty-text">Planeringen visas h√§r n√§r du gjort ett val.</p>
        </div>
      {% else %}
        <div class="planning-result" aria-live="polite">
          <div class="summary-cards" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:12px;">
            <div class="kp-card" style="text-align:center;">
              <div style="font-size:0.9rem;color:#334155;">Boende totalt</div>
              <div style="font-size:2rem;font-weight:700;">{{ vm.summary.total_residents }}</div>
            </div>
            <div class="kp-card" style="text-align:center;">
              <div style="font-size:0.9rem;color:#334155;">Specialkost totalt</div>
              <div style="font-size:2rem;font-weight:700;">{{ vm.summary.total_special }}</div>
            </div>
            <div class="kp-card" style="text-align:center;">
              <div style="font-size:0.9rem;color:#334155;">Normalkost totalt</div>
              <div style="font-size:2rem;font-weight:700;">{{ vm.summary.total_normal }}</div>
            </div>
          </div>

          <h3>Specialkost per typ</h3>
          {% if vm.summary.breakdown and vm.summary.breakdown|length > 0 %}
            <ul>
              {% for row in vm.summary.breakdown %}
                <li>{{ row.diet_type_name }}: <strong>{{ row.count }}</strong></li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="empty-text">Inga markerade specialkoster f√∂r vald m√•ltid.</p>
          {% endif %}

          {% if vm.summary.per_department and vm.summary.per_department|length > 0 %}
            <details style="margin-top:8px;">
              <summary>Per avdelning</summary>
              <table class="grid-table" style="margin-top:8px;">
                <thead>
                  <tr><th>Avdelning</th><th>Boende</th><th>Special</th><th>Normal</th></tr>
                </thead>
                <tbody>
                  {% for d in vm.summary.per_department %}
                    <tr>
                      <td style="text-align:left;">{{ d.name }}</td>
                      <td>{{ d.residents }}</td>
                      <td>{{ d.special }}</td>
                      <td>{{ d.normal }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </details>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
  {% include "ui/_menu_modal.html" %}
  <script src="/static/js/menu_modal.js"></script>
</body>
</html>
