{% extends "ui/unified_admin_base.html" %}

{% block title %}
{% if vm.mode == 'new' %}
Ny anv√§ndare - Unified Admin
{% else %}
Redigera anv√§ndare - Unified Admin
{% endif %}
{% endblock %}

{% block admin_main %}
<section class="ua-section">
<div class="ua-card admin-users-form">
    <!-- Header -->
    <div class="page-header">
        <h1>
            {% if vm.mode == 'new' %}
            Ny anv√§ndare
            {% else %}
            Redigera anv√§ndare
            {% endif %}
        </h1>
        <a href="{{ url_for('ui.admin_users_list') }}" class="yp-button yp-button-secondary">
            ‚Üê Tillbaka
        </a>
    </div>

    <!-- Form -->
    <div class="form-container">
        <form method="post" 
              action="{% if vm.mode == 'new' %}{{ url_for('ui.admin_users_create') }}{% else %}{{ url_for('ui.admin_users_update', user_id=vm.user.id) }}{% endif %}"
              class="yp-form user-form">
            
            <!-- Username (only for new users) -->
            {% if vm.mode == 'new' %}
            <div class="yp-form-field">
                <label for="username" class="yp-label">
                    üë§ Anv√§ndarnamn <span class="required">*</span>
                </label>
                <input type="text" 
                       id="username" 
                       name="username" 
                       class="yp-input"
                       required
                       maxlength="100"
                       autocomplete="off"
                       aria-label="Anv√§ndarnamn"
                       placeholder="t.ex. jdoe eller john.doe">
                <small class="yp-form-help">Unikt anv√§ndarnamn f√∂r inloggning.</small>
            </div>
            {% else %}
            <div class="yp-form-field">
                <label class="yp-label">üë§ Anv√§ndarnamn</label>
                <div class="read-only-field">{{ vm.user.username }}</div>
                <small class="yp-form-help">Anv√§ndarnamn kan inte √§ndras.</small>
            </div>
            {% endif %}

            <!-- Email -->
            <div class="yp-form-field">
                <label for="email" class="yp-label">
                    üìß E-post <span class="required">*</span>
                </label>
                <input type="email" 
                       id="email" 
                       name="email" 
                       class="yp-input"
                       required
                       maxlength="200"
                       autocomplete="email"
                       aria-label="E-postadress"
                       value="{% if vm.user %}{{ vm.user.email }}{% endif %}"
                       placeholder="namn@example.com">
                <small class="yp-form-help">Anv√§nds f√∂r kommunikation och √•terst√§llning av l√∂senord.</small>
            </div>

            <!-- Full Name -->
            <div class="yp-form-field">
                <label for="full_name" class="yp-label">
                    üè∑Ô∏è Fullst√§ndigt namn
                </label>
                <input type="text" 
                       id="full_name" 
                       name="full_name" 
                       class="yp-input"
                       maxlength="200"
                       autocomplete="name"
                       aria-label="Fullst√§ndigt namn"
                       value="{% if vm.user %}{{ vm.user.full_name or '' }}{% endif %}"
                       placeholder="F√∂r- och efternamn">
                <small class="yp-form-help">Valfritt, visas i anv√§ndargr√§nssnittet.</small>
            </div>

            <!-- Role -->
            <div class="yp-form-field">
                <label for="role" class="yp-label">
                    üë• Roll <span class="required">*</span>
                </label>
                <select id="role" name="role" class="yp-input" required aria-label="Roll">
                    {% for r in vm.available_roles %}
                    <option value="{{ r }}" {% if vm.user and vm.user.role == r %}selected{% endif %}>
                        {% if r == 'admin' %}
                            üë§ Admin
                        {% elif r == 'superuser' %}
                            ‚≠ê Superanv√§ndare
                        {% elif r == 'staff' %}
                            üë• Personal
                        {% elif r == 'cook' %}
                            üë®‚Äçüç≥ Kock
                        {% elif r == 'unit_portal' %}
                            üè¢ Enhetsportal
                        {% else %}
                            {{ r }}
                        {% endif %}
                    </option>
                    {% endfor %}
                </select>
                <small class="yp-form-help">
                    <strong>Admin:</strong> Full √•tkomst till admin-panelen.<br>
                    <strong>Personal:</strong> Grundl√§ggande √•tkomst till veckovisning.<br>
                    <strong>Kock:</strong> √Ötkomst till matlagningsvyer.<br>
                    <strong>Enhetsportal:</strong> √Ötkomst till enhetsspecifika funktioner.
                </small>
            </div>

            <!-- Password (only for new users) -->
            {% if vm.mode == 'new' %}
            <div class="yp-form-field">
                <label for="password" class="yp-label">
                    üîë L√∂senord <span class="required">*</span>
                </label>
                <input type="password" 
                       id="password" 
                       name="password" 
                       class="yp-input"
                       required
                       minlength="6"
                       autocomplete="new-password"
                       aria-label="L√∂senord"
                       placeholder="Minst 6 tecken">
                <small class="yp-form-help">Tillf√§lligt l√∂senord. Anv√§ndaren b√∂r √§ndra det efter f√∂rsta inloggningen.</small>
            </div>
            {% else %}
            <div class="yp-form-field">
                <label class="yp-label">üîë L√∂senord</label>
                <div class="password-info">
                    <p>L√∂senord kan inte √§ndras h√§r.</p>
                    <p>Anv√§nd knappen "√Öterst√§ll l√∂senord" p√• anv√§ndarlistan f√∂r att generera ett nytt tillf√§lligt l√∂senord.</p>
                </div>
            </div>
            {% endif %}

            <!-- Buttons -->
            <div class="form-actions">
                <button type="submit" class="yp-button yp-button-primary">
                    {% if vm.mode == 'new' %}
                    üíæ Skapa anv√§ndare
                    {% else %}
                    üíæ Spara √§ndringar
                    {% endif %}
                </button>
                <a href="{{ url_for('ui.admin_users_list') }}" class="yp-button yp-button-secondary">
                    ‚úñ Avbryt
                </a>
            </div>
        </form>
    </div>
</div>

<style>
.admin-users-form {
    max-width: 700px;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.page-header h1 {
    margin: 0;
    font-size: 1.75rem;
    color: #2c3e50;
}

.form-container {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 2rem;
}

.user-form {
    max-width: 100%;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #495057;
}

.form-group label.required::after {
    content: ' *';
    color: #dc3545;
}

.form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 1rem;
    transition: border-color 0.2s, box-shadow 0.2s;
}

.form-control:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
}

.form-control:invalid {
    border-color: #dc3545;
}

.form-text {
    display: block;
    margin-top: 0.25rem;
    font-size: 0.875rem;
    color: #6c757d;
    line-height: 1.4;
}

.read-only-field {
    padding: 0.75rem;
    background: #e9ecef;
    border: 1px solid #ced4da;
    border-radius: 4px;
    color: #495057;
    font-weight: 500;
}

.password-info {
    padding: 1rem;
    background: #fff3cd;
    border: 1px solid #ffc107;
    border-radius: 4px;
    color: #856404;
}

.password-info p {
    margin: 0 0 0.5rem 0;
}

.password-info p:last-child {
    margin-bottom: 0;
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #dee2e6;
}

.btn {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-primary {
    background: #007bff;
    color: white;
}

.btn-primary:hover {
    background: #0056b3;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #545b62;
}

@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        align-items: stretch;
    }
    
    .page-header h1 {
        font-size: 1.5rem;
    }
    
    .form-container {
        padding: 1.5rem;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        text-align: center;
    }
}
</style>
</div>
</section>
{% endblock %}
