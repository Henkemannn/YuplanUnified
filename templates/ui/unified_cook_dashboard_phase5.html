{% extends "ui/unified_admin_base.html" %}
{% block admin_title %}Kockvy – {{ vm.date }}{% endblock %}
{% block admin_subtitle %}Överblick och totals för dagens måltider.{% endblock %}
{% block admin_main %}
<section class="ua-section"><div class="ua-card">
<div class="yp-page">
  <div class="yp-page-header">
    <h1>Kockvy</h1>
    <p>Dagens överblick – {{ vm.weekday_name }} {{ vm.date }}</p>
  </div>

  <section class="yp-section">
    <h2>Dagens totals</h2>
    <div class="yp-grid yp-grid--cols-2">
      {% for meal in vm.meals %}
      <div class="yp-card">
        <h3>{{ meal.name }}</h3>
        <p><strong>Normalkost:</strong> {{ meal.totals_normalkost }}</p>
        <p><strong>Specialkost:</strong> {{ meal.totals_specials }}</p>
        {% if meal.alt2_count is not none %}
        <p><strong>Alt2:</strong> {{ meal.alt2_count }}</p>
        {% endif %}
        {% if meal.status == 'done' %}
        <span class="yp-badge yp-badge--success">Klar</span>
        {% elif meal.status == 'partial' %}
        <span class="yp-badge yp-badge--warning">Delvis klar</span>
        {% else %}
        <span class="yp-badge yp-badge--neutral">Ej klar</span>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </section>

  <section class="yp-section">
    <h2>Per arbetsplats/avdelning</h2>
    {% for site in vm.sites %}
      <div class="yp-card">
        <h3>{{ site.site_name }}</h3>
        <table class="yp-table">
          <thead>
            <tr>
              <th>Avdelning</th>
              <th>Lunch</th>
              <th>Kväll</th>
              <th>Åtgärder</th>
            </tr>
          </thead>
          <tbody>
            {% for dep in site.departments %}
            <tr>
              <td>{{ dep.name }}</td>
              <td>
                Normalkost: {{ dep.residents_lunch - dep.specials_lunch }}
                <span class="badge">Special: {{ dep.specials_lunch }}</span>
                {% if dep.alt2_today %}<span class="badge">Alt2</span>{% endif %}
              </td>
              <td>
                Normalkost: {{ dep.residents_dinner - dep.specials_dinner }}
                <span class="badge">Special: {{ dep.specials_dinner }}</span>
              </td>
              <td>
                <a href="{{ dep.planera_lunch_url }}" class="yp-link">Planera lunch</a>
                <a href="{{ dep.planera_dinner_url }}" class="yp-link">Planera kväll</a>
                <a href="{{ dep.veckovy_url }}" class="yp-link">Veckovy</a>
                <a href="{{ dep.report_url }}" class="yp-link">Rapport</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endfor %}
  </section>

  <section class="yp-section">
    <h2>Snabblänkar</h2>
    <div class="yp-actions">
      <a href="/ui/planera/day" class="yp-button">Planera idag</a>
      <a href="/ui/planera/week" class="yp-button">Planera vecka</a>
      <a href="/ui/portal/week" class="yp-button">Veckovy (kök)</a>
      <a
        href="{{ url_for('ui.cook_week_overview_unified', year=vm.date.isocalendar()[0], week=vm.date.isocalendar()[1]) }}"
        class="yp-button yp-button-primary"
      >Öppna veckovy</a>
      <a href="/ui/reports/weekly.xlsx" class="yp-button">Veckorapport</a>
    </div>
  </section>

  <section class="yp-section cook-panel cook-panel-department-status">
    <h2>Avdelningsstatus – vecka {{ vm.date.isocalendar()[1] }}</h2>
    {% if vm.department_portal_status %}
    <ul class="department-status-list">
      {% for dep in vm.department_portal_status %}
      <li class="department-status-item">
        <a href="{{ url_for('ui.portal_week_unified_path', year=dep.year, week=dep.week, department_id=dep.department_id) }}" class="department-name-link">
          <span class="department-name">{{ dep.department_name }}</span>
          <span class="department-name-icon" aria-hidden="true">↗</span>
        </a>
        <span class="badge badge-status {% if dep.is_complete %}badge-status-complete{% else %}badge-status-pending{% endif %}">
          {% if dep.is_complete %}
            Klar ({{ dep.completed_days }}/{{ dep.total_days }})
          {% else %}
            Inte klar ({{ dep.completed_days }}/{{ dep.total_days }})
          {% endif %}
        </span>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-muted">Inga avdelningar hittades för denna site.</p>
    {% endif %}
  </section>
</div>
</div></section>
{% endblock %}
