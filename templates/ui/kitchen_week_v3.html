<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <title>Kök – Veckovy</title>
  <link rel="stylesheet" href="/static/css/kitchen_week_v3.css" />
  <style>
    .dept-card { border: 1px solid #ddd; border-radius: 6px; padding: 12px; margin: 10px 0; }
    .dept-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .grid-table { width:100%; border-collapse: collapse; }
    .grid-table th, .grid-table td { border:1px solid #eee; padding:6px; text-align:center; }
    .diet-name { text-align:left; font-weight:600; }
    .kostcell-btn { width:100%; padding:8px 6px; border-radius:4px; border:1px solid #ccc; background:#fafafa; cursor:pointer; }
    .kostcell-btn.is-done { outline: 2px solid #3b82f6; }
    .kostcell-btn.is-alt2 { background:#fff7c2; }
    .toolbar { display:flex; gap:8px; margin-bottom:12px; }
  </style>
</head>
<body>
  <div class="toolbar">
    <h1 style="flex:1; margin:0;">Kök – Veckovy</h1>
    <button type="button" id="printBtn">Skriv ut</button>
  </div>
  <div class="meta">År {{ vm.year }} • Vecka {{ vm.week }}</div>
  {% for dep in vm.departments %}
    <div class="dept-card" data-department-id="{{ dep.id }}">
      <div class="dept-header">
        <div><strong>{{ dep.name }}</strong></div>
        <div>{{ dep.resident_count }} boende</div>
      </div>
      {% if dep.no_diets %}
        <div style="color:#666; font-style:italic;">Inga specialkoster kopplade</div>
      {% else %}
        <table class="grid-table" aria-label="Specialkostöversikt">
          <thead>
            <tr>
              <th>Kosttyp</th>
              <th>Mån</th>
              <th>Tis</th>
              <th>Ons</th>
              <th>Tors</th>
              <th>Fre</th>
              <th>Lör</th>
              <th>Sön</th>
            </tr>
          </thead>
          <tbody>
            {% for row in dep.diet_rows %}
              <tr>
                <td class="diet-name">{{ row.diet_type_name }}</td>
                {% for dow in range(1,8) %}
                  <td>
                    {% set lunch = row.cells[(dow-1)*2] %}
                    {% set dinner = row.cells[(dow-1)*2+1] %}
                    <div style="display:flex; gap:4px;">
                      <button class="kostcell-btn {{ 'is-done' if lunch.is_done }} {{ 'is-alt2' if lunch.is_alt2 }}"
                        data-department-id="{{ dep.id }}"
                        data-diet-type-id="{{ row.diet_type_id }}"
                        data-year="{{ vm.year }}"
                        data-week="{{ vm.week }}"
                        data-day-index="{{ lunch.day_index }}"
                        data-meal="lunch"
                        aria-label="Lunch {{ row.diet_type_name }} dag {{ lunch.day_index }}">
                        L {{ lunch.count }}
                      </button>
                      <button class="kostcell-btn {{ 'is-done' if dinner.is_done }}"
                        data-department-id="{{ dep.id }}"
                        data-diet-type-id="{{ row.diet_type_id }}"
                        data-year="{{ vm.year }}"
                        data-week="{{ vm.week }}"
                        data-day-index="{{ dinner.day_index }}"
                        data-meal="dinner"
                        aria-label="Middag {{ row.diet_type_name }} dag {{ dinner.day_index }}">
                        M {{ dinner.count }}
                      </button>
                    </div>
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
  {% endfor %}
  <script src="/static/js/kitchen_week_v3.js"></script>
</body>
</html>
