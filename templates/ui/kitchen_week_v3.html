<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <title>KÃ¶k â€“ Veckovy</title>
  <!-- Use existing unified cook stylesheet to avoid missing CSS 404 -->
  <link rel="stylesheet" href="/static/css/unified_cook.css" />
  <!-- UI uses class 'is-alt2' to indicate lunch Alt2 availability -->
</head>
<body>
  <div class="toolbar">
    <h1 class="page-title">KÃ¶k â€“ Veckovy</h1>
    <button type="button" id="printBtn">Skriv ut</button>
  </div>
  <p class="kw-helper">Klicka pÃ¥ siffran nÃ¤r specialkost har anpassats.</p>
  <div class="meta">Ã…r {{ vm.year }} â€¢ Vecka {{ vm.week }}</div>
  <div class="toolbar toolbar-right">
    <a href="/ui/kitchen/week?year={{ vm.prev_year }}&week={{ vm.prev_week }}{% if vm.site_id %}&site_id={{ vm.site_id }}{% endif %}" aria-label="FÃ¶regÃ¥ende vecka">â† FÃ¶regÃ¥ende vecka</a>
    <a href="/ui/kitchen/week?year={{ vm.next_year }}&week={{ vm.next_week }}{% if vm.site_id %}&site_id={{ vm.site_id }}{% endif %}" aria-label="NÃ¤sta vecka">NÃ¤sta vecka â†’</a>
  </div>
  {% for dep in vm.departments %}
    <div class="dept-card" data-department-id="{{ dep.id }}">
      <div class="dept-header">
        {% set _dn = dep.name or '' %}
        {% set dep_display = _dn if _dn[:4]|lower == 'avd ' else 'Avd ' ~ _dn %}
        <div class="dept-title">{{ dep_display }}</div>
        <div class="boende-badge">{{ dep.resident_count }} boende</div>
      </div>
      {% if dep.info_text %}
        <div class="yp-info-box">{{ dep.info_text }}</div>
      {% endif %}
      {% if dep.no_diets %}
        <div class="dept-empty">Inga specialkoster kopplade</div>
      {% else %}
        <table class="grid-table" aria-label="SpecialkostÃ¶versikt">
          <thead>
            <tr>
              <th>Kosttyp</th>
              <th colspan="2">MÃ¥n</th>
              <th colspan="2">Tis</th>
              <th colspan="2">Ons</th>
              <th colspan="2">Tors</th>
              <th colspan="2">Fre</th>
              <th colspan="2">LÃ¶r</th>
              <th colspan="2">SÃ¶n</th>
            </tr>
            <tr class="grid-subhead">
              <th></th>
              <th class="meal-icon" aria-label="Lunch">ğŸ½ï¸</th>
              <th class="meal-icon" aria-label="Middag">ğŸŒ™</th>
              <th class="meal-icon" aria-label="Lunch">ğŸ½ï¸</th>
              <th class="meal-icon" aria-label="Middag">ğŸŒ™</th>
              <th class="meal-icon" aria-label="Lunch">ğŸ½ï¸</th>
              <th class="meal-icon" aria-label="Middag">ğŸŒ™</th>
              <th class="meal-icon" aria-label="Lunch">ğŸ½ï¸</th>
              <th class="meal-icon" aria-label="Middag">ğŸŒ™</th>
              <th class="meal-icon" aria-label="Lunch">ğŸ½ï¸</th>
              <th class="meal-icon" aria-label="Middag">ğŸŒ™</th>
              <th class="meal-icon" aria-label="Lunch">ğŸ½ï¸</th>
              <th class="meal-icon" aria-label="Middag">ğŸŒ™</th>
              <th class="meal-icon" aria-label="Lunch">ğŸ½ï¸</th>
              <th class="meal-icon" aria-label="Middag">ğŸŒ™</th>
            </tr>
          </thead>
          <tbody>
            <tr class="boende-row">
              <td class="diet-name">Boende</td>
              {% for dow in range(1,8) %}
                {% set d = dep.days[dow-1] %}
                <td class="kw-cell day-start">{{ d.residents.lunch if d and d.residents else 0 }}</td>
                <td class="kw-cell">{{ d.residents.dinner if d and d.residents else 0 }}</td>
              {% endfor %}
            </tr>
            {% for row in dep.diet_rows %}
              <tr class="diet-row">
                <td class="diet-name">{{ row.diet_type_name }}</td>
                {% for dow in range(1,8) %}
                  {% set lunch = row.cells[(dow-1)*2] %}
                  {% set dinner = row.cells[(dow-1)*2+1] %}
                  <td class="kw-cell day-start {{ 'is-alt2' if lunch.is_alt2 else '' }}">
                    <button class="kostcell-btn {{ 'is-done' if lunch.is_done else '' }}"
                      data-department-id="{{ dep.id }}"
                      data-diet-type-id="{{ row.diet_type_id }}"
                      data-year="{{ vm.year }}"
                      data-week="{{ vm.week }}"
                      data-day-index="{{ lunch.day_index }}"
                      data-meal="lunch"
                      aria-label="Lunch {{ row.diet_type_name }} dag {{ lunch.day_index }}">
                      {{ lunch.count }}
                    </button>
                  </td>
                  <td class="kw-cell">
                    <button class="kostcell-btn {{ 'is-done' if dinner.is_done else '' }}"
                      data-department-id="{{ dep.id }}"
                      data-diet-type-id="{{ row.diet_type_id }}"
                      data-year="{{ vm.year }}"
                      data-week="{{ vm.week }}"
                      data-day-index="{{ dinner.day_index }}"
                      data-meal="dinner"
                      aria-label="Middag {{ row.diet_type_name }} dag {{ dinner.day_index }}">
                      {{ dinner.count }}
                    </button>
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
  {% endfor %}
  <script src="/static/js/kitchen_week_v3.js"></script>
</body>
</html>
