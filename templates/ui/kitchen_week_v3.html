<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <title>Kök – Veckovy</title>
  <!-- Use existing unified cook stylesheet to avoid missing CSS 404 -->
  <link rel="stylesheet" href="/static/css/unified_cook.css" />
  <!-- UI uses class 'is-alt2' to indicate lunch Alt2 availability -->
</head>
<body>
  <div class="toolbar">
    <h1 class="page-title">Kök – Veckovy</h1>
    <button type="button" id="printBtn">Skriv ut</button>
  </div>
  <p class="kw-helper">Klicka på siffran när specialkost har anpassats.</p>
  <div class="meta">År {{ vm.year }} • Vecka {{ vm.week }}</div>
  <div class="toolbar toolbar-right">
    <a href="/ui/kitchen/week?year={{ vm.prev_year }}&week={{ vm.prev_week }}{% if vm.site_id %}&site_id={{ vm.site_id }}{% endif %}" aria-label="Föregående vecka">← Föregående vecka</a>
    <a href="/ui/kitchen/week?year={{ vm.next_year }}&week={{ vm.next_week }}{% if vm.site_id %}&site_id={{ vm.site_id }}{% endif %}" aria-label="Nästa vecka">Nästa vecka →</a>
  </div>
  {% for dep in vm.departments %}
    <div class="dept-card" data-department-id="{{ dep.id }}">
      <div class="dept-header">
        <div class="dept-title">Avd {{ dep.name }} • {{ dep.resident_count }} boende</div>
      </div>
      {% if dep.info_text %}
        <div class="yp-info-box">{{ dep.info_text }}</div>
      {% endif %}
      {% if dep.no_diets %}
        <div class="dept-empty">Inga specialkoster kopplade</div>
      {% else %}
        <table class="grid-table" aria-label="Specialkostöversikt">
          <thead>
            <tr>
              <th>Kosttyp</th>
              <th>Mån</th>
              <th>Tis</th>
              <th>Ons</th>
              <th>Tors</th>
              <th>Fre</th>
              <th>Lör</th>
              <th>Sön</th>
            </tr>
          </thead>
          <tbody>
            {% for row in dep.diet_rows %}
              <tr>
                <td class="diet-name">{{ row.diet_type_name }}</td>
                {% for dow in range(1,8) %}
                  <td>
                    {% set lunch = row.cells[(dow-1)*2] %}
                    {% set dinner = row.cells[(dow-1)*2+1] %}
                    <div class="kw-cell-buttons {{ 'is-alt2' if lunch.is_alt2 else '' }}">
                      <button class="kostcell-btn {{ 'is-done' if lunch.is_done else '' }} {{ 'is-alt2' if lunch.is_alt2 else '' }}"
                        data-department-id="{{ dep.id }}"
                        data-diet-type-id="{{ row.diet_type_id }}"
                        data-year="{{ vm.year }}"
                        data-week="{{ vm.week }}"
                        data-day-index="{{ lunch.day_index }}"
                        data-meal="lunch"
                        aria-label="Lunch {{ row.diet_type_name }} dag {{ lunch.day_index }}">
                        L {{ lunch.count }}
                      </button>
                      <button class="kostcell-btn {{ 'is-done' if dinner.is_done else '' }}"
                        data-department-id="{{ dep.id }}"
                        data-diet-type-id="{{ row.diet_type_id }}"
                        data-year="{{ vm.year }}"
                        data-week="{{ vm.week }}"
                        data-day-index="{{ dinner.day_index }}"
                        data-meal="dinner"
                        aria-label="Middag {{ row.diet_type_name }} dag {{ dinner.day_index }}">
                        M {{ dinner.count }}
                      </button>
                    </div>
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </div>
  {% endfor %}
  <script src="/static/js/kitchen_week_v3.js"></script>
</body>
</html>
