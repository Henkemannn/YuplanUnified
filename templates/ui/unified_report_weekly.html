{% extends "ui/unified_admin_base.html" %}

{% block title %}Yuplan Unified{% endblock %}

{# Unified UI CSS/JS inherited from base template #}

{% block content %}
<div class="admin-header">
    <div class="header-flex">
        <div>
            <h1>Veckorapport ‚Äì Registrering</h1>
            <p class="subtitle">Vecka {{ vm.week }}, {{ vm.year }} ‚Äì {{ vm.site_name }}</p>
        </div>
        <div class="header-actions">
            <a href="{{ url_for('ui.admin_menu_planning_index') }}" class="yp-button yp-button-secondary">
                ‚Üê Tillbaka till admin
            </a>
        </div>
    </div>
</div>

<!-- Week Navigation -->
<div class="card">
    <div class="card-body">
        <div class="week-navigation">
            <a href="{{ url_for('ui.reports_weekly', year=vm.prev_year, week=vm.prev_week) }}" class="yp-button yp-button-secondary">
                ‚Üê F√∂reg√•ende vecka
            </a>
            <a href="{{ url_for('ui.reports_weekly', year=vm.current_year, week=vm.current_week) }}" class="yp-button yp-button-primary">
                üìÖ Denna vecka
            </a>
            <a href="{{ url_for('ui.reports_weekly', year=vm.next_year, week=vm.next_week) }}" class="yp-button yp-button-secondary">
                N√§sta vecka ‚Üí
            </a>
        </div>
    </div>
</div>

<!-- Coverage Report Table -->
{% if vm.coverage_data|length == 0 %}
<div class="empty-state">
    <p>Inga avdelningar hittades f√∂r denna site.</p>
    <a href="{{ url_for('ui.admin_departments_list') }}" class="yp-button yp-button-primary">‚ûï Skapa avdelningar</a>
</div>
{% else %}
<div class="card">
    <div class="card-header">
        <h2>Registrerings√∂versikt per avdelning</h2>
        <p class="help-text">Visar antal registrerade m√•ltider i f√∂rh√•llande till planerade m√•ltider f√∂r veckan.</p>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="yp-table report-table">
                <thead>
                    <tr>
                        <th class="dept-col">AVDELNING</th>
                        <th class="count-col">LUNCH</th>
                        <th class="count-col">KV√ÑLL</th>
                        <th class="percent-col">TOTALT</th>
                    </tr>
                </thead>
                <tbody>
                    {% for dept in vm.coverage_data %}
                    <tr>
                        <td class="dept-name">{{ dept.department_name }}</td>
                        <td class="count-cell">
                            <span class="yp-badge yp-badge-muted">üç¥ {{ dept.lunch_registered }}/{{ dept.lunch_expected }}</span>
                        </td>
                        <td class="count-cell">
                            <span class="yp-badge yp-badge-muted">üåô {{ dept.dinner_registered }}/{{ dept.dinner_expected }}</span>
                        </td>
                        <td class="percent-cell">
                            <span class="yp-badge {% if dept.coverage_percent >= 90 %}yp-badge-success{% elif dept.coverage_percent >= 70 %}yp-badge-warning{% else %}yp-badge-danger{% endif %}">
                                {% if dept.coverage_percent >= 90 %}‚úì{% elif dept.coverage_percent >= 70 %}‚ö†Ô∏è{% else %}‚úó{% endif %} {{ dept.coverage_percent }}%
                            </span>
                            <span class="count-detail">({{ dept.total_registered }}/{{ dept.total_expected }})</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Legend -->
<div class="legend-box">
    <h3>F√∂rklaring</h3>
    <div class="legend-items">
        <div class="legend-item">
            <span class="yp-badge yp-badge-success">‚úì 90%+</span>
            <span>H√∂g t√§ckning (‚â• 90%)</span>
        </div>
        <div class="legend-item">
            <span class="yp-badge yp-badge-warning">‚ö†Ô∏è 70-89%</span>
            <span>Medel t√§ckning (70-89%)</span>
        </div>
        <div class="legend-item">
            <span class="yp-badge yp-badge-danger">‚úó &lt; 70%</span>
            <span>L√•g t√§ckning (&lt; 70%)</span>
        </div>
    </div>
    <p class="help-text">
        <strong>Lunch/Kv√§ll:</strong> Antal registrerade m√•ltider / antal planerade m√•ltider.<br>
        <strong>Totalt:</strong> Procentuell t√§ckning av alla m√•ltider under veckan.
    </p>
</div>
{% endif %}

<style>
/* Week Navigation (using unified tokens) */
.week-navigation {
    display: flex;
    gap: var(--yp-gap);
    justify-content: center;
    align-items: center;
}

/* Report Table (using unified tokens) */
.report-table {
    width: 100%;
    border-collapse: collapse;
}

.report-table th {
    background-color: var(--yp-color-bg-alt);
    padding: 0.75rem;
    text-align: left;
    font-weight: var(--yp-font-weight-semibold);
    border-bottom: 2px solid var(--yp-color-border);
}

.report-table td {
    padding: 0.75rem;
    border-bottom: 1px solid var(--yp-color-border);
}

.dept-col {
    width: 40%;
}

.count-col {
    width: 20%;
    text-align: center;
}

.percent-col {
    width: 20%;
    text-align: center;
}

.dept-name {
    font-weight: var(--yp-font-weight-medium);
}

.count-cell {
    text-align: center;
}

.count-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background-color: var(--yp-color-bg-alt);
    border-radius: var(--yp-radius-sm);
    font-size: var(--yp-font-size-sm);
    font-weight: var(--yp-font-weight-medium);
}

.percent-cell {
    text-align: center;
}

.percent-badge {
    display: inline-block;
    padding: 0.375rem 0.75rem;
    border-radius: var(--yp-radius-sm);
    font-weight: var(--yp-font-weight-semibold);
    font-size: var(--yp-font-size-base);
}

/* Coverage badges (using unified semantic colors) */
.coverage-high {
    background-color: var(--yp-color-success-light);
    color: var(--yp-color-success-dark);
    border: 1px solid var(--yp-color-success);
}

.coverage-medium {
    background-color: var(--yp-color-warning-light);
    color: var(--yp-color-warning-dark);
    border: 1px solid var(--yp-color-warning);
}

.coverage-low {
    background-color: var(--yp-color-danger-light);
    color: var(--yp-color-danger-dark);
    border: 1px solid var(--yp-color-danger);
}

.count-detail {
    display: block;
    font-size: var(--yp-font-size-xs);
    color: var(--yp-color-text-muted);
    margin-top: 0.25rem;
}

/* Legend (using unified tokens) */
.legend-box {
    margin-top: var(--yp-gap-xl);
    padding: var(--yp-gap-lg);
    background-color: var(--yp-color-bg-alt);
    border-radius: var(--yp-radius);
}

.legend-box h3 {
    margin-top: 0;
    margin-bottom: var(--yp-gap);
    font-size: var(--yp-font-size-lg);
}

.legend-items {
    display: flex;
    gap: var(--yp-gap-xl);
    margin-bottom: var(--yp-gap);
    flex-wrap: wrap;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: var(--yp-gap-sm);
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .week-navigation {
        flex-direction: column;
    }
    
    .table-responsive {
        overflow-x: auto;
    }
    
    .report-table {
        min-width: 600px;
    }
    
    .legend-items {
        flex-direction: column;
        gap: 0.75rem;
    }
}
</style>
{% endblock %}
