<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Avdelningsportalen â€“ Vecka {{ vm.week }}, {{ vm.year }}</title>
    {% if vm.site_name %}<meta name="x-site" content="{{ vm.site_name }}">{% endif %}
    <link rel="stylesheet" href="{{ url_for('static', filename='unified_ui.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='unified_portal.css') }}">
</head>
<body class="portal-layout">
    {% include 'includes/yuplan_header.html' ignore missing %}

    <header class="portal-header">
        <h1 class="portal-title">Avdelningsportalen</h1>
        <p class="portal-subtitle">Vecka {{ vm.week }}, {{ vm.year }} â€“ {{ vm.department_name }}, {{ vm.site_name }}</p>
        <p class="portal-date">Dagens datum: {{ vm.current_date }}</p>
    </header>

    <section class="portal-day-grid" aria-label="Veckans meny">
        {% for day in vm.days %}
        <article class="portal-day-card yp-card {% if day.is_today %}is-today{% endif %}" data-is-today="{% if day.is_today %}true{% else %}false{% endif %}">
            <header class="day-header">
                <h2 class="day-heading">{{ day.weekday_name }} <span class="day-date">{{ day.date }}</span></h2>
            </header>
            <div class="meal-block">
                <h3 class="meal-label">ğŸ½ LUNCH</h3>
                <p class="meal-dish">{{ day.menu.lunch.alt1 or 'Ingen rÃ¤tt' }}</p>
                {% if day.alt2_lunch %}
                  <span class="yp-badge yp-badge-warning" title="Alternativ rÃ¤tt vald">âš¡ Alt 2</span>
                {% endif %}
                {% if day.menu.lunch.alt2 %}
                  <p class="meal-alt2">Alt 2: {{ day.menu.lunch.alt2 }}</p>
                {% endif %}
                {% if day.menu.lunch.dessert %}
                  <p class="meal-dessert">Dessert: {{ day.menu.lunch.dessert }}</p>
                {% endif %}
                <div class="meal-meta">
                    <span class="residents">Boende: {{ day.residents.lunch }}</span>
                    {% if day.registered.lunch %}
                      <span class="yp-badge yp-badge-success">âœ“ Registrerad</span>
                    {% else %}
                      <span class="yp-badge yp-badge-muted">Ej gjord</span>
                    {% endif %}
                </div>
                {% if day.default_diets and day.default_diets|length > 0 %}
                <div class="diets-row">
                    {% for d in day.default_diets %}
                      <span class="yp-badge yp-badge-neutral diet-pill">{{ d.name }} [{{ d.count }}]</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% if vm.has_dinner and day.menu.dinner.alt1 %}
            <div class="meal-block dinner-block">
                <h3 class="meal-label">ğŸŒ™ KVÃ„LLSMAT</h3>
                <p class="meal-dish">{{ day.menu.dinner.alt1 }}</p>
                <div class="meal-meta">
                    <span class="residents">Boende: {{ day.residents.dinner }}</span>
                    {% if day.registered.dinner %}
                      <span class="yp-badge yp-badge-success">âœ“ Registrerad</span>
                    {% else %}
                      <span class="yp-badge yp-badge-muted">Ej gjord</span>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </article>
        {% endfor %}
    </section>

    <footer class="portal-footer">
        <nav class="portal-actions" aria-label="Snabbnavigering">
            <a class="yp-button" href="/ui/weekview?site_id={{ vm.site_id }}&department_id={{ vm.department_id }}&year={{ vm.year }}&week={{ vm.week }}">â†© Veckovy</a>
            <a class="yp-button" href="/ui/weekview?site_id={{ vm.site_id }}&department_id={{ vm.department_id }}">ğŸ“… Denna vecka</a>
            <a class="yp-button" href="/ui/cook">ğŸ§‘â€ğŸ³ Kockvy</a>
            <a class="yp-button yp-button-secondary" href="/auth/logout">ğŸ”’ Logga ut</a>
        </nav>
    </footer>

    {% include 'includes/yuplan_footer.html' ignore missing %}
    <script src="{{ url_for('static', filename='unified_ui.js') }}" defer></script>
    <script src="{{ url_for('static', filename='unified_portal.js') }}" defer></script>
</body>
</html>
