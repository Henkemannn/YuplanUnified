<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Yuplan Offshore</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='app.css') }}?v=20250911-02" rel="stylesheet">
  <link rel="icon" href="{{ url_for('static', filename='Yuplanlogo_offshore.svg') }}">
  <style>
    body { font-size: 18px; }
  .meal-card { border-left: 6px solid #0d6efd; border-radius: .5rem; border: 1px solid rgba(0,0,0,.06); }
    /* Stronger, card-wide backgrounds for menykort */
    .meal-card.lunsj { border-left-color: #198754; background: #e9f7ef; }
    .meal-card.middag { border-left-color: #0d6efd; background: #e9f0ff; }
    .meal-card.lunsj .fw-bold { color: #198754 !important; }
    .meal-card.middag .fw-bold { color: #0d6efd !important; }
    .meal-card a { color: inherit; text-decoration: none; }
    .meal-card a:hover { text-decoration: underline; }
    .done { opacity: 0.5; text-decoration: line-through; }
    .sticky-actions { position: sticky; top: 0; z-index: 1; background: #fff; padding: .5rem 0; }
    .big-check { transform: scale(1.3); margin-right: .5rem; }
    .navbar-brand img { height: 36px; }
    .container, .container-fluid { max-width: 1200px; }
    /* Clean header tweaks */
    .navbar-brand .brand-name { font-size: 1.05rem; font-weight: 800; }
    .navbar-brand .brand-tagline { font-size: .8rem; }
    .logo-pill { padding: 0; border: none; background: transparent; box-shadow: none; }
    .navbar-light .navbar-nav .nav-link { font-weight: 600; }
    /* Inline editor compactness */
    .menu-item { padding: 2px 0; }
    .menu-item .dish-name { line-height: 1.2; display: inline-block; min-width: 8ch; }
    .menu-item .inline-als, .menu-item .inline-glu, .menu-item .alg-count { display: none; }
    .menu-item:hover .inline-als, .menu-item:focus-within .inline-als,
    .menu-item:hover .inline-glu, .menu-item:focus-within .inline-glu,
    .menu-item:hover .alg-count, .menu-item:focus-within .alg-count { display: inline-flex; }
    .allergen-chips .badge { font-size: .65rem; }
    .meal-card .fw-bold { font-size: .95rem; }
    .meal-card ul { margin-bottom: 0; }
    .meal-card li { margin-bottom: .15rem; }

    /* Print styles: clean weekly/daily cards without controls */
    @media print {
      nav.navbar, .brand-strip, .sticky-actions, .open-day-editor, .open-prep, .open-send-admin,
      .inline-als, .inline-glu, .alg-count, .dropdown-toggle, .btn, .modal, .navbar-text { display: none !important; }
      a { text-decoration: none; color: black; }
      .container, .container-fluid { max-width: 100%; }
      body { font-size: 12pt; }
      .meal-card { box-shadow: none !important; background: white !important; }
      .allergen-chips .badge { border: 1px solid #999; color: #000 !important; background: #fff !important; }
    }
  </style>
</head>
<body>
{% if not request.endpoint or request.endpoint not in ['login', 'register', 'superuser_login', 'admin_login'] %}
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm mb-0">
  <div class="container-fluid">
  <a class="navbar-brand d-flex align-items-center gap-2" href="{{ url_for('dashboard') }}">
  <span class="logo-glow"><img src="{{ url_for('static', filename='Yuplanlogo_offshore.svg') }}" alt="Yuplan" /></span>
    <span class="d-flex flex-column lh-1">
      <span class="brand-name">Yuplan Offshore{% if rig_name %} â€“ {{ rig_name }}{% endif %}</span>
      <small class="brand-tagline text-muted">KjÃ¸kkenplanlegging</small>
    </span>
  </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Meny">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="mainNavbar">
      <ul class="navbar-nav mb-2 mb-lg-0 gap-lg-2">
        {% if session.get('role') == 'admin' %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('admin_dashboard') }}">Admin</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('admin_menu') }}">Ukemeny</a></li>
        {% endif %}
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('menus_overview') }}">Menyer</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('messages_center') }}">Meldinger</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-danger" href="{{ url_for('logout') }}">Logg ut</a>
        </li>
      </ul>
  <!-- Removed version badge for clean marketing screenshots -->
    </div>
  </div>
</nav>
<div class="brand-strip"></div>
<!-- Global compact banner (moved from dashboard) -->
<div class="bg-light border-bottom top-info-bar py-1 small">
  <div class="container-fluid d-flex flex-wrap align-items-center gap-2 top-info-inner">
    {% set clean = request.args.get('clean') == '1' %}
    <span class="fw-semibold">{{ session.get('user_name') or '' }}</span>
    {% if not clean %}
      <span class="badge text-bg-light border" title="Dagens dato">{{ today_str }}</span>
      {% if DEMO_MODE %}<span class="badge text-bg-warning text-dark" title="DemolÃ¤ge â€“ ingen ekte lagring">DEMO</span>{% endif %}
      {% if current_menu_week %}<span class="badge text-bg-info" title="Aktuell 4-ukers meny (i dag)">Meny: {{ current_menu_week }}</span>{% endif %}
      {% if iso_week %}<span class="badge text-bg-secondary" title="Kalenderuke (mandagâ€“sÃ¸ndag)">Uke {{ iso_week }}</span>{% endif %}
    {% endif %}
    {% if period_progress %}
      <span class="text-muted ms-2">Periode:</span>
      <div class="progress" style="width:120px; height:8px;">
        {% set _pp = period_progress.percent if period_progress.percent is not none else 0 %}
        <div class="progress-bar {{ period_progress.color_class if period_progress.color_class else '' }}" role="progressbar" style="width: {{ _pp }}%;" aria-valuenow="{{ _pp }}" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <span class="text-muted">{{ period_progress.day_index + 1 }}/{{ period_progress.total_days }}</span>
    {% elif next_period_start %}
      <span class="ms-2 text-muted">Neste periode starter {{ next_period_start }}</span>
    {% endif %}
  {% if not clean and today_task_summary and (today_task_summary.prep_open or today_task_summary.frys_open or today_task_summary.prep_done or today_task_summary.frys_done) %}
      <span class="ms-2">ðŸ§°</span>
      <a href="{{ url_for('day_detail', date_s=today_task_summary.date) }}" class="text-decoration-none d-flex align-items-center gap-1">
        <span class="badge text-bg-danger" title="Ã…pne prepp">P {{ today_task_summary.prep_open }}</span>
        <span class="badge text-bg-success" title="Ferdige prepp">Pâœ“ {{ today_task_summary.prep_done }}</span>
        <span class="badge text-bg-danger" title="Ã…pne frys">F {{ today_task_summary.frys_open }}</span>
        <span class="badge text-bg-success" title="Ferdige frys">Fâœ“ {{ today_task_summary.frys_done }}</span>
      </a>
    {% endif %}
  </div>
</div>
{% endif %}
<div class="container my-4">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{% autoescape false %}{{ message }}{% endautoescape %}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  {% block content %}{% endblock %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Global toast container -->
<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1080;">
  <div id="app-toast" class="toast align-items-center text-bg-dark border-0" role="status" aria-live="polite" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="app-toast-body">Melding</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Lukk"></button>
    </div>
  </div>
  <div id="app-toast-success" class="toast align-items-center text-bg-success border-0 mt-2" role="status" aria-live="polite" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="app-toast-success-body">Lagring vellykket</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Lukk"></button>
    </div>
  </div>
  <div id="app-toast-error" class="toast align-items-center text-bg-danger border-0 mt-2" role="status" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="app-toast-error-body">Noe gikk galt</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Lukk"></button>
    </div>
  </div>
  <div id="app-toast-info" class="toast align-items-center text-bg-info border-0 mt-2" role="status" aria-live="polite" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="app-toast-info-body">Info</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Lukk"></button>
    </div>
  </div>
  </div>
<script>
  window.showToast = function(type, message) {
    const id = type === 'success' ? 'app-toast-success' : type === 'error' ? 'app-toast-error' : type === 'info' ? 'app-toast-info' : 'app-toast';
    const el = document.getElementById(id);
    const body = document.getElementById(id + (type ? '-body' : '-body')) || el.querySelector('.toast-body');
    if (body) body.textContent = message || body.textContent;
    const t = new bootstrap.Toast(el, { delay: 2500 });
    t.show();
  };
</script>
</body>
</html>
